---
title: "Lab 5"
author: "Senan Hogan-H."
date: "19 April 2018"
output:
  pdf_document: default
  html_document: default
  word_document: default
header-includes:
- \usepackage{amsmath}
- \usepackage{hyperref}
---

Completed with James Kinney, around 50/50 work completed between us.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE, fig.align="center")
gc()
ls()
library(tidyverse)
set.seed(47)
```

## 2  Normal Data

a. 

b. 

c. 

```{r}
schools <- read.table ("schools.dat", header = T)
J <- nrow (schools)
y <- schools$estimate
sigma.y <- schools$sd
data <- list ("J", "y", "sigma.y") inits <- function()
  list (
    theta = rnorm(J, 0, 100),
    mu.theta = rnorm(1, 0, 100),
    sigma.theta = runif(1, 0, 100)
  )
parameters <- c("theta", "mu.theta", "sigma.theta")
theta.update <- function () {
  theta.hat <-
    (mu / tau ^ 2 + y / sigma.y ^ 2) / (1 / tau ^ 2 + 1 / sigma.y ^
                                          2)
  V.theta <- 1 / (1 / tau ^ 2 + 1 / sigma.y ^ 2)
  rnorm(J, theta.hat, sqrt(V.theta))
}
mu.update <- function () {
  rnorm(1, mean(theta), tau / sqrt(J))
}
tau.update <- function () {
  sqrt(sum((theta - mu) ^ 2) / rchisq(1, J - 1))
}
n.chains <- 5
n.iter <- 1000

sims <- array (NA, c(n.iter, n.chains, J + 2))
dimnames(sims) <-
  list (NULL, NULL, c(paste("theta[", 1:8, "]", sep = ""), "mu", "tau"))
for (m in 1:n.chains) {
  mu <- rnorm (1, mean(y), sd(y))
  tau <- runif (1, 0, sd(y))
  for (t in 1:n.iter) {
    theta <- theta.update()
    mu <- mu.update()
    tau <- tau.update()
    sims[t, m,] <- c(theta, mu, tau)
  }
}

big <- c()
for (i in 1:1000) {
  big[i] <- sum(sims[i,1,1:8]>28)
}
mean(big)


```